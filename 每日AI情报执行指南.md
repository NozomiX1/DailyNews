# 任务执行指南

> 本文档是给未来的 Claude (AI) 看的操作手册，用于完成每日 AI 情报的抓取、总结、清理和发布。

---

## 任务概述

每天执行以下流程：
1. 爬取三个公众号（机器之心、新智元、量子位）今天的文章
2. 逐个阅读文章并生成总结
3. 检查并删除重复文章和广告
4. 发布到微信公众号草稿箱

---

## 步骤 1: 爬取文章

### 执行命令

在工作目录 `/Users/nozomi/Desktop/projects/DailyNews` 下执行：

```bash
python src/wechat_fetcher.py
```

### 预期结果

- 程序会自动爬取今天发布的文章
- 文章保存到 `data/articles/YYYY-MM-DD/` 目录
- 文件命名格式：`{公众号名}_{序号}.md`

### 确认文件已生成

使用 Glob 工具检查：

```python
glob pattern: data/articles/*/*.md
```

或使用 Bash：

```bash
ls -la data/articles/$(date +%Y-%m-%d)/
```

### 异常处理

| 问题 | 解决方法 |
|------|---------|
| Cookie 过期 | 提示用户从浏览器 DevTools 复制最新 Cookie 到 `cookie1.txt` |
| 找不到公众号 | 检查公众号名称是否正确，或尝试重新获取 fakeid |
| 无文章 | 检查目标公众号今天是否发布文章 |

---

## 步骤 2: 逐个总结文章

### ⚠️⚠️⚠️ 极其重要：边读边写！逐个生成摘要！

**【严禁错误做法】**把所有文章一次性读完，再批量生成摘要。这会导致：
- 上下文爆炸，超出 token 限制
- 后面处理的文章质量下降
- 遗漏或混淆文章内容
- 违背本指南的核心设计原则

**【正确做法】严格按照以下流程执行：**

1. 初始化报告文件（仅头部）
2. 循环处理每篇文章：
   - **读取 1 篇文章**（使用 Read 工具）
   - **立即生成该篇的摘要**
   - **立即追加写入报告文件**（使用 Edit 工具追加到文件末尾）
   - 重复处理下一篇

**正确执行示例**：
```python
# 伪代码示例
for article in articles:
    content = read(article)           # 步骤1：读一篇
    summary = generate_summary(content)  # 步骤2：立即生成摘要
    append_to_report(summary)          # 步骤3：立即写入
    # 不要等所有文章读完！
```

**验证检查点**：
- 每处理 3-5 篇文章后，检查报告文件是否已更新
- 确保摘要数量与处理进度一致
- 报告文件应该在处理过程中逐步增长，而非一次性生成

**【核心原则】**
> 读一篇 → 写一篇 → 释放内存 → 读下一篇

这是防止上下文爆炸的唯一正确方法。任何批量处理、事后写入的做法都是错误的！

### 2.1 初始化报告文件

首先创建报告文件头部：

```markdown
# AI 每日情报 | YYYY-MM-DD

## 📊 今日情报

```

**注意**：`YYYY-MM-DD` 使用文章日期（今天）。例如今天是1月30日，爬取的是1月30日的文章，标题应为 `AI 每日情报 | 2026-01-30`。

保存到 `output/YYYY-MM-DD/daily_report.md`

### 2.2 逐篇处理文章

使用 Glob 工具获取文章列表，然后对每篇文章：

1. **使用 Read 工具读取单篇文章内容**

2. **分析文章并生成总结**，要求：
   - **提取核心事件**：发生了什么新闻？
   - **识别关键信息**：数字、人名、公司名、技术名、产品名
   - **判断重要性**：这件事为什么重要？有什么影响？
   - **评估价值**：根据内容质量给出评分（见下方评分标准）
   - **生成摘要**：
     - 根据内容丰富度决定长度
     - 简短新闻：3-5 句话
     - 技术深度文章：可以更长，但保持摘要性质，不要罗列所有细节
     - 信息密集，避免废话
   - **生成标题**：
     - 符合事实，避免标题党
     - 简洁明了，一眼看出核心内容
     - 不要用夸张的词汇（"震惊"、"爆"等）

3. **文章价值评分标准**：

| 评分 | 定义 | 典型内容特征 | AI 领域具体判断依据 |
|------|------|----------|---------------------|
| 🌟 | 噪音/软广 | 纯标题党、情绪化宣泄、无实质内容的公关稿 | • 全篇堆砌 buzzwords (AGI, 颠覆, 革命) 但无干货<br>• 简单的 API 套壳产品宣传，无技术壁垒<br>• 已知信息的简单重复搬运 |
| 🌟🌟 | 快讯/简报 | 行业动态、简单的新闻通报、版本更新日志 | • 某模型/产品发布的消息（What happened）<br>• 简单的参数对比表<br>• 缺乏深度分析的行业资讯 |
| 🌟🌟🌟 | 实用/科普 | 具体的教程、完整的评测、清晰的概念解释 | • 实操类：Prompt 优化教程、本地部署指南<br>• 解释类：把复杂论文讲得通俗易懂<br>• 评测类：有真实数据的模型对比测试 |
| 🌟🌟🌟🌟 | 深度/洞察 | 技术原理拆解、独特的行业思考、工程实践复盘 | • 技术：源码级解析、架构优化思路、训练细节披露<br>• 行业：对生态格局的独到推演（非人云亦云）<br>• 工程：大厂落地 AI 的真实踩坑经验 (Post-mortem) |
| 🌟🌟🌟🌟🌟 | 典藏/灯塔 | 奠基性论文、颠覆性创新、极具前瞻性的长文 | • SOTA：提出 Transformer、LoRA 等级的新架构/方法<br>• 思想：重塑人们对 AI 认知的长文（如 Andrej Karpathy 的博客）<br>• 全面：极具参考价值的 Awesome 列表或万字综述 |

**评分原则（严格遵守）**：
- **5🌟 极其罕见**：奠基性论文、颠覆性创新（Transformer、AlphaGo级别），每日15篇文章中最多0-1篇
- **4🌟 稀少**：有真正的技术原理拆解、独特行业思考、工程踩坑复盘，每日最多2-3篇
- **3🌟 较多**：技术细节丰富、完整评测、教程科普，每日5-8篇
- **2🌟 最多**：产品发布消息、行业动态、简单参数对比，每日占比最高
- **1🌟**：纯标题党、无实质内容（通常直接删除，不放入日报）

**正态分布参考**（15篇文章）：
- 🌟🌟：5-7篇
- 🌟🌟🌟：5-7篇
- 🌟🌟🌟🌟：1-2篇
- 🌟🌟🌟🌟🌟：0-1篇

4. **文章类型标签**：

根据文章内容自由添加标签，允许多个。参考示例：`[发布]`、`[访谈]`、`[研究]`、`[融资]`、`[开源]`、`[裁员]`、`[技术]`、`[行业]`、`[观点]` 等。

5. **输出格式**（严格遵循）：

```markdown
### N. [新标题]
**来源**: 公众号名 | **时间**: 2026-01-28 07:00
**价值**: 🌟🌟🌟 **标签**: [访谈][开源]
**链接**: https://mp.weixin.qq.com/s/xxx

**摘要**: 这里是摘要内容...

---
```

### 2.3 组装完整报告

将所有文章的总结按顺序拼接，开头加上标题：

```markdown
# AI 每日情报 | YYYY-MM-DD

## 📊 今日情报

[这里放所有文章的总结]
```

### 2.4 保存报告

使用 Write 工具保存到：

```
output/YYYY-MM-DD/daily_report.md
```

---

## 步骤 3: 检查重复和广告

### 3.1 读取已生成的报告

使用 Read 工具读取：
```
output/YYYY-MM-DD/daily_report.md
```

### 3.2 识别重复文章

**判断标准**：
- 多个公众号报道同一事件/新闻
- 标题或摘要内容高度相似
- 涉及同一公司/产品的同一消息

**处理方式**：
- 保留优先级：**新智元 > 机器之心 > 量子位**
- 删除重复文章，只保留一篇
- 记录删除了什么（在日志中说明）

### 3.3 识别广告文章

**关键词识别**：
- 广告、推广、赞助、合作、招商
- 课程、限时优惠、立即购买、扫码报名
- 诚招代理、商务合作、广告位

**处理方式**：
- 直接删除广告文章

### 3.4 重新编号

删除文章后，重新编号剩余文章（从 1 开始）

### 3.5 更新文件

使用 Write 工具覆盖保存更新后的内容。

---

## 步骤 4: 发布到草稿箱

### 执行命令

```bash
python src/wechat_publisher.py --date YYYY-MM-DD
```

如果不指定日期，默认处理今天的报告。

### 预期结果

```
✅ 草稿创建成功！
📋 Media ID: xxxxx
👉 请登录微信公众号后台查看草稿箱
```

### 异常处理

| 问题 | 解决方法 |
|------|---------|
| 报告文件不存在 | 检查 output/YYYY-MM-DD/daily_report.md 是否存在 |
| access_token 获取失败 | 检查 APP_ID 和 APP_SECRET 配置 |
| 草稿创建失败 | 检查 COVER_MEDIA_ID 是否有效，或网络问题 |

---

## 完整工作流示例

```bash
# 1. 爬取文章
python src/wechat_fetcher.py

# 2. Claude 处理：读取文章 → 生成总结 → 保存到 output/YYYY-MM-DD/daily_report.md
# [Claude 手动完成]

# 3. Claude 处理：检查重复和广告 → 更新 daily_report.md
# [Claude 手动完成]

# 4. 发布到草稿箱
python src/wechat_publisher.py --date 2026-01-28
```

---

## 注意事项

1. **Cookie 有效期**：微信 Cookie 会过期，如果爬取失败，提醒用户更新
2. **日期处理**：默认处理"今天"的文章
3. **文章质量**：遇到明显低质量或无关文章，可以跳过不总结
4. **摘要长度**：灵活调整，重要新闻可以写详细，简单新闻简短即可
5. **标题规范**：避免原标题的标题党倾向，生成更客观的描述性标题

---

## 文件路径速查

| 用途 | 路径 |
|------|------|
| 爬取的文章 | `data/articles/YYYY-MM-DD/*.md` |
| 生成的报告 | `output/YYYY-MM-DD/daily_report.md` |
| 配置文件 | `config.py` |
| fakeid 缓存 | `fakeid_cache.json` |
| Cookie 文件 | `cookie1.txt` |
